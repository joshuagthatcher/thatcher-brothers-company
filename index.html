<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>

  <!-- GA4 tracking code -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9DH6CC2PRP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    const query = window.location.search;

    // CONFIG: send full URL with query to GA so it sees all UTMs
    gtag('config', 'G-9DH6CC2PRP', {
      'page_path': window.location.pathname + query
    });

    // Build redirect URL to your Google Form
    const redirectUrl = "https://docs.google.com/forms/d/e/1FAIpQLSeRrEb1b2lgd1_b8mjU62tjvZrM6DUJ9gcxbMXA392msS_5OA/viewform" + query;

    let redirected = false;

    // Send QR scan event to GA with all UTM parameters
    gtag('event', 'qr_scan', {
      'utm_source': new URLSearchParams(query).get('utm_source') || '',
      'utm_medium': new URLSearchParams(query).get('utm_medium') || '',
      'utm_campaign': new URLSearchParams(query).get('utm_campaign') || '',
      'utm_content': new URLSearchParams(query).get('utm_content') || '',
      'utm_id': new URLSearchParams(query).get('utm_id') || '',
      'event_callback': () => {
        if (!redirected) {
          redirected = true;
          window.location.href = redirectUrl;
        }
      }
    });

    // Fallback redirect after 3 seconds in case event_callback doesn’t fire
    setTimeout(() => {
      if (!redirected) {
        redirected = true;
        window.location.href = redirectUrl;
      }
    }, 3000);

    // Show user a message while redirecting
    document.body.innerHTML = "<p>Redirecting… please wait.</p>";
  </script>
</head>
<body>
  Redirecting…
</body>
</html>
