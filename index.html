<script async src="https://www.googletagmanager.com/gtag/js?id=G-9DH6CC2PRP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  // THIS LINE IS REQUIRED
  gtag('config', 'G-9DH6CC2PRP');

  const query = window.location.search;

  // Build redirect URL
  const redirectUrl = "https://docs.google.com/forms/d/e/1FAIpQLSeRrEb1b2lgd1_b8mjU62tjvZrM6DUJ9gcxbMXA392msS_5OA/viewform" + query;

  // Send QR scan event
  gtag('event', 'qr_scan', {
    'utm_source': new URLSearchParams(query).get('utm_source') || '',
    'utm_medium': new URLSearchParams(query).get('utm_medium') || '',
    'utm_campaign': new URLSearchParams(query).get('utm_campaign') || '',
    'utm_content': new URLSearchParams(query).get('utm_content') || '',
    'utm_id': new URLSearchParams(query).get('utm_id') || '',
    'event_callback': () => {
      // Redirect after GA confirms the event
      window.location.replace(redirectUrl);
    }
  });

  // Fallback in case event_callback doesnâ€™t fire (e.g., GA blocked)
  setTimeout(() => { window.location.replace(redirectUrl); }, 1500);
</script>
